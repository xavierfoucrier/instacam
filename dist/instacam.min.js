/*!
  instacam â€“ Instant canvas video
  Xavier Foucrier @xavierfoucrier 2018 MIT
  1.1.2
*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Instacam",[],e):"object"==typeof exports?exports.Instacam=e():t.Instacam=e()}(window,function(){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(o,r,function(e){return t[e]}.bind(null,r));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);let o={width:400,height:300,camera:!0,framerate:30,ratio:4/3,sound:!1,volume:100,mirror:!1,opacity:1,brightness:1,contrast:1,saturation:1,hue:0,invert:0,grayscale:0,sepia:0,blur:0,url:"",filter:null,done:null,fail:null,unsupported:null},r="requestAnimationFrame"in window&&"mediaDevices"in navigator&&"Promise"in window;i.d(e,"Instacam",function(){return n});class n{constructor(t,e){if(this.options=Object.assign({},o,e),r){if("string"==typeof t&&(t=document.querySelector(t)),void 0===t||null===t||"canvas"!==t.nodeName.toLowerCase())throw new Error("Invalid viewport, you need to pass a valid selector or HTML5 canvas element");this.viewport=t,this.viewport.width=this.options.width,this.viewport.height=this.options.height,this.media=document.createElement("video"),this.media.style.display="none",this.media.autoplay=!0,this.media.width=this.options.width,this.media.height=this.options.height,this.viewport.parentNode.insertBefore(this.media,this.viewport.nextSibling),this.mirror=this.options.mirror,this._compute(),this._capture()}else"function"==typeof this.options.unsupported&&this.options.unsupported()}_capture(){try{navigator.mediaDevices.getUserMedia({audio:this.options.sound,video:(()=>!1!==this.options.camera&&{frameRate:this.options.framerate,aspectRatio:this.options.ratio})()}).then(t=>{this.media.srcObject=t,this.volume=this.options.volume;const e=()=>{"function"!=typeof this.options.filter?this.viewport.getContext("2d").drawImage(this.media,0,0,this.options.width,this.options.height):(void 0===this._buffer&&(this._buffer=document.createElement("canvas"),this._buffer.style.display="none",this._buffer.width=this.options.width,this._buffer.height=this.options.height,this.viewport.parentNode.insertBefore(this._buffer,this.viewport.nextSibling)),this._buffer.getContext("2d").drawImage(this.media,0,0,this.options.width,this.options.height),this.viewport.getContext("2d").putImageData(this._filter(this._buffer.getContext("2d").getImageData(0,0,this.options.width,this.options.height)),0,0)),requestAnimationFrame(e)};requestAnimationFrame(e),"function"==typeof this.options.done&&this.options.done()}).catch(t=>{"function"==typeof this.options.fail&&this.options.fail(t)})}catch(t){"function"==typeof this.options.fail&&this.options.fail(t)}}_compute(){this._style=this.options.opacity!==o.opacity?`opacity(${this.options.opacity}) `:"",this._style+=this.options.brightness!==o.brightness?`brightness(${this.options.brightness}) `:"",this._style+=this.options.contrast!==o.contrast?`contrast(${this.options.contrast}) `:"",this._style+=this.options.saturation!==o.saturation?`saturate(${this.options.saturation}) `:"",this._style+=this.options.hue!==o.hue?`hue-rotate(${this.options.hue}deg) `:"",this._style+=this.options.invert!==o.invert?`invert(${this.options.invert}) `:"",this._style+=this.options.grayscale!==o.grayscale?`grayscale(${this.options.grayscale}) `:"",this._style+=this.options.sepia!==o.sepia?`sepia(${this.options.sepia}) `:"",this._style+=this.options.blur!==o.blur?`blur(${this.options.blur}px) `:"",this._style+=this.options.url!==o.url?`url(${this.options.url}) `:"",this.viewport.style.filter=this._style}_filter(t){let e=t.data;try{for(let t=0;t<this.options.height;t++)for(let i=0;i<this.options.width;i++){const o=4*(this.options.width*t+i),r=this.options.filter({offset:o,x:i,y:t,red:e[o],green:e[o+1],blue:e[o+2],alpha:e[o+3]});e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3]}return t}catch(t){throw new Error("Invalid filter, you need to return a valid [red, green, blue, alpha] pixel array")}}snap(t=0,e=0,i=this.options.width,o=this.options.height){if(i<=0||o<=0)throw new Error("Invalid snap area, you need to specify a positive width and height for your image capture");return this.viewport.getContext("2d").getImageData(t,e,i,o)}save(t="png",e=1){return this.viewport.toDataURL("image/"+t,e)}get volume(){return this.options.volume}set volume(t){if("number"!=typeof t||t<0||t>100)throw new Error("Invalid volume, you need to give a number between 0 and 100");this.media.volume=this.options.volume=t/100}get mirror(){return this.options.mirror}set mirror(t){if("boolean"!=typeof t)throw new Error("Invalid mirror mode, you need to give a boolean to enable or disable the mirror mode");let e=getComputedStyle(this.viewport).getPropertyValue("transform");e="none"!==e?e:"",this.viewport.style.transform=!0===t?`${e} scale(-1, 1)`:"",this.options.mirror=t}get opacity(){return this.options.opacity}set opacity(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid opacity, you need to give a number between 0 and 1");this.options.opacity=t,this._compute()}get brightness(){return this.options.brightness}set brightness(t){if("number"!=typeof t||t<0)throw new Error("Invalid brightness, you need to give a number above 0");this.options.brightness=t,this._compute()}get contrast(){return this.options.contrast}set contrast(t){if("number"!=typeof t||t<0)throw new Error("Invalid contrast, you need to give a number above 0");this.options.contrast=t,this._compute()}get saturation(){return this.options.saturation}set saturation(t){if("number"!=typeof t||t<0)throw new Error("Invalid saturation, you need to give a number above 0");this.options.saturation=t,this._compute()}get hue(){return this.options.hue}set hue(t){if("number"!=typeof t||t<0||t>360)throw new Error("Invalid hue, you need to give a number between 0 and 360");this.options.hue=t,this._compute()}get invert(){return this.options.invert}set invert(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid invert, you need to give a number between 0 and 1");this.options.invert=t,this._compute()}get grayscale(){return this.options.grayscale}set grayscale(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid grayscale, you need to give a number between 0 and 1");this.options.grayscale=t,this._compute()}get sepia(){return this.options.sepia}set sepia(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid sepia, you need to give a number between 0 and 1");this.options.sepia=t,this._compute()}get blur(){return this.options.blur}set blur(t){if("number"!=typeof t||t<0)throw new Error("Invalid blur, you need to give a number above 0");this.options.blur=t,this._compute()}get url(){return this.options.url}set url(t){if("string"!=typeof t)throw new Error("Invalid url, you need to give a string");this.options.url=t,this._compute()}get filter(){return this.options.filter}set filter(t){if(null!==t&&"function"!=typeof t)throw new Error("Invalid filter, you need to give a function or null to disable the custom filtering");this.options.filter=t}}}]).Instacam});