/*!
  instacam â€“ Instant canvas video
  Xavier Foucrier @xavierfoucrier 2018 MIT
  1.5.2
*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Instacam",[],e):"object"==typeof exports?exports.Instacam=e():t.Instacam=e()}(window,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.e)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.e?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);let r={width:400,height:300,autostart:!0,camera:!0,framerate:30,ratio:4/3,sound:!1,volume:100,mirror:!1,opacity:1,brightness:1,contrast:1,saturation:1,hue:0,invert:0,grayscale:0,sepia:0,blur:0,url:"",blend:{},filter:null,done:null,fail:null,unsupported:null},n="requestAnimationFrame"in window&&"mediaDevices"in navigator&&"Promise"in window;i.d(e,"Instacam",function(){return s});class s{constructor(t,e){if(this.h=Object.assign({},r,e),n){if("string"==typeof t&&(t=document.querySelector(t)),void 0===t||null===t||"canvas"!==t.nodeName.toLowerCase())throw new Error("Invalid viewport, you need to pass a valid selector or HTML5 canvas element");this.viewport=t,this.viewport.width=this.h.width,this.viewport.height=this.h.height,this.a=document.createElement("video"),this.a.style.display="none",this.a.autoplay=!0,this.a.width=this.h.width,this.a.height=this.h.height,this.viewport.parentNode.insertBefore(this.a,this.viewport.nextSibling),this.mirror=this.h.mirror,!0===this.h.autostart&&(this.u(),this.f())}else"function"==typeof this.h.unsupported&&this.h.unsupported()}f(){try{navigator.mediaDevices.getUserMedia({audio:this.h.sound,video:(()=>!1!==this.h.camera&&{frameRate:this.h.framerate,aspectRatio:this.h.ratio})()}).then(t=>{this.b=t,this.a.srcObject=t,this.volume=this.h.volume;const e=()=>{"function"!=typeof this.h.filter?this.viewport.getContext("2d").drawImage(this.a,0,0,this.h.width,this.h.height):(void 0===this.v&&(this.v=document.createElement("canvas"),this.v.style.display="none",this.v.width=this.h.width,this.v.height=this.h.height,this.viewport.parentNode.insertBefore(this.v,this.viewport.nextSibling)),this.v.getContext("2d").drawImage(this.a,0,0,this.h.width,this.h.height),this.viewport.getContext("2d").putImageData(this.g(this.v.getContext("2d").getImageData(0,0,this.h.width,this.h.height)),0,0)),requestAnimationFrame(e)};requestAnimationFrame(e),"function"==typeof this.h.done&&this.h.done()}).catch(t=>{"function"==typeof this.h.fail&&this.h.fail(t)})}catch(t){"function"==typeof this.h.fail&&this.h.fail(t)}}u(){if(this.w=this.h.opacity!==r.opacity?`opacity(${this.h.opacity}) `:"",this.w+=this.h.brightness!==r.brightness?`brightness(${this.h.brightness}) `:"",this.w+=this.h.contrast!==r.contrast?`contrast(${this.h.contrast}) `:"",this.w+=this.h.saturation!==r.saturation?`saturate(${this.h.saturation}) `:"",this.w+=this.h.hue!==r.hue?`hue-rotate(${this.h.hue}deg) `:"",this.w+=this.h.invert!==r.invert?`invert(${this.h.invert}) `:"",this.w+=this.h.grayscale!==r.grayscale?`grayscale(${this.h.grayscale}) `:"",this.w+=this.h.sepia!==r.sepia?`sepia(${this.h.sepia}) `:"",this.w+=this.h.blur!==r.blur?`blur(${this.h.blur}px) `:"",this.w+=this.h.url!==r.url?`url(${this.h.url}) `:"",this.viewport.style.filter=this.w,0!==Object.keys(this.h.blend).length){void 0===this.I&&(this.I=document.createElement("div"),this.viewport.parentNode.insertBefore(this.I,this.viewport));const t=this.viewport.getBoundingClientRect();this.I.style=`position:absolute;z-index:1;left:${t.left}px;top:${t.top}px;width:${t.width}px;height:${t.height}px;mix-blend-mode:${this.h.blend.mode};background:${this.h.blend.color};pointer-events:none;`}else void 0!==this.I&&(this.I.parentNode.removeChild(this.I),delete this.I)}g(t){let e=t.data;try{for(let t=0;t<this.h.height;t++)for(let i=0;i<this.h.width;i++){const r=4*(this.h.width*t+i),n=this.h.filter({offset:r,x:i,y:t,red:e[r],green:e[r+1],blue:e[r+2],alpha:e[r+3]});e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3]}return t}catch(t){throw new Error("Invalid filter, you need to return a valid [red, green, blue, alpha] pixel array")}}start(){this.u(),this.f()}stop(){void 0!==this.b&&(this.b.getTracks().forEach(function(t){t.stop()}),this.a.srcObject=null)}snap(t=0,e=0,i=this.h.width,r=this.h.height){if(i<=0||r<=0)throw new Error("Invalid snap area, you need to specify a positive width and height for your image capture");return this.viewport.getContext("2d").getImageData(t,e,i,r)}save(t="png",e=1){return this.viewport.toDataURL("image/"+t,e)}get volume(){return this.h.volume}set volume(t){if("number"!=typeof t||t<0||t>100)throw new Error("Invalid volume, you need to give a number between 0 and 100");this.a.volume=this.h.volume=t/100}get mirror(){return this.h.mirror}set mirror(t){if("boolean"!=typeof t)throw new Error("Invalid mirror mode, you need to give a boolean to enable or disable the mirror mode");let e=getComputedStyle(this.viewport).getPropertyValue("transform");e="none"!==e?e:"",this.viewport.style.transform=!0===t?`${e} scale(-1, 1)`:"",this.h.mirror=t}get opacity(){return this.h.opacity}set opacity(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid opacity, you need to give a number between 0 and 1");this.h.opacity=t,this.u()}get brightness(){return this.h.brightness}set brightness(t){if("number"!=typeof t||t<0)throw new Error("Invalid brightness, you need to give a number above 0");this.h.brightness=t,this.u()}get contrast(){return this.h.contrast}set contrast(t){if("number"!=typeof t||t<0)throw new Error("Invalid contrast, you need to give a number above 0");this.h.contrast=t,this.u()}get saturation(){return this.h.saturation}set saturation(t){if("number"!=typeof t||t<0)throw new Error("Invalid saturation, you need to give a number above 0");this.h.saturation=t,this.u()}get hue(){return this.h.hue}set hue(t){if("number"!=typeof t||t<0||t>360)throw new Error("Invalid hue, you need to give a number between 0 and 360");this.h.hue=t,this.u()}get invert(){return this.h.invert}set invert(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid invert, you need to give a number between 0 and 1");this.h.invert=t,this.u()}get grayscale(){return this.h.grayscale}set grayscale(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid grayscale, you need to give a number between 0 and 1");this.h.grayscale=t,this.u()}get sepia(){return this.h.sepia}set sepia(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid sepia, you need to give a number between 0 and 1");this.h.sepia=t,this.u()}get blur(){return this.h.blur}set blur(t){if("number"!=typeof t||t<0)throw new Error("Invalid blur, you need to give a number above 0");this.h.blur=t,this.u()}get url(){return this.h.url}set url(t){if("string"!=typeof t)throw new Error("Invalid url, you need to give a string");this.h.url=t,this.u()}get blend(){return this.h.blend}set blend(t){if("object"!=typeof t)throw new Error("Invalid blend, you need to give a valid object with {mode|color} or an empty object to disable blending");this.h.blend=t,this.u()}get filter(){return this.h.filter}set filter(t){if(null!==t&&"function"!=typeof t)throw new Error("Invalid filter, you need to give a function or null to disable the custom filtering");this.h.filter=t}get style(){return 0!==this.w.length?this.w.trim().split(" "):[]}}}]).Instacam});