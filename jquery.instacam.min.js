(function(f){f.instacam=function(c,g){var a=this,d={width:400,height:300,mirror:!1,camera:!0,framerate:30,ratio:4/3,sound:!1,volume:100,opacity:1,brightness:1,contrast:1,saturation:0,hue:0,invert:0,grayscale:0,sepia:0,blur:0,url:"",filter:null,done:null,fail:null,unsupported:null},m=function(e){try{navigator.getUserMedia({video:!1===a.settings.camera?!1:{mandatory:{minFrameRate:"number"==typeof a.settings.framerate&&0<a.settings.framerate?a.settings.framerate:d.framerate,maxFrameRate:"number"==typeof a.settings.framerate&&0<a.settings.framerate?a.settings.framerate:d.framerate,minAspectRatio:"number"==typeof a.settings.ratio&&0<a.settings.ratio?a.settings.ratio:d.ratio,maxAspectRatio:"number"==typeof a.settings.ratio&&0<a.settings.ratio?a.settings.ratio:d.ratio}},audio:a.settings.sound},function(h){e.src=window.URL.createObjectURL(h);e.addEventListener("play",function(){e.volume=("number"==typeof a.settings.volume&&0<=a.settings.volume&&100>=a.settings.volume?a.settings.volume:d.volume)/100});var k=function(){requestAnimationFrame(k);"function"!=typeof a.settings.filter?c.getContext("2d").drawImage(e,0,0,a.settings.width,a.settings.height):("undefined"==typeof a.buffer&&(a.buffer=document.createElement("canvas"),a.buffer.style.display="none",a.buffer.width=a.settings.width,a.buffer.height=a.settings.height,c.parentNode.insertBefore(a.buffer,c.nextSibling)),a.buffer.getContext("2d").drawImage(e,0,0,a.settings.width,a.settings.height),c.getContext("2d").putImageData(l(a.buffer.getContext("2d").getImageData(0,0,a.settings.width,a.settings.height)),0,0));var b=a.settings.opacity!=d.opacity?"opacity("+a.settings.opacity+") ":"",b=b+(a.settings.brightness!=d.brightness?"brightness("+a.settings.brightness+") ":""),b=b+(a.settings.contrast!=d.contrast?"contrast("+a.settings.contrast+") ":""),b=b+(a.settings.saturation!=d.saturation?"saturate("+a.settings.saturation+") ":""),b=b+(a.settings.hue!=d.hue?"hue-rotate("+a.settings.hue+"deg) ":""),b=b+(a.settings.invert!=d.invert?"invert("+a.settings.invert+") ":""),b=b+(a.settings.grayscale!=d.grayscale?"grayscale("+a.settings.grayscale+") ":""),b=b+(a.settings.sepia!=d.sepia?"sepia("+a.settings.sepia+") ":""),b=b+(a.settings.blur!=d.blur?"blur("+a.settings.blur+"px) ":""),b=b+(a.settings.url!=d.url?"url("+a.settings.url+") ":"");""!==b&&a.css!=b?(f(c).css({filter:b,"-webkit-filter":b}),a.css=b):""===b&&(f(c).css({filter:"","-webkit-filter":""}),a.css="");!0===a.settings.mirror?f(c).css({transform:"scale(-1, 1)","-webkit-transform":"scale(-1, 1)"}):f(c).css({transform:"","-webkit-transform":""})};requestAnimationFrame(k);"function"==typeof a.settings.done&&a.settings.done(e,c)},function(h){"function"==typeof a.settings.fail&&a.settings.fail(h,e,c)})}catch(h){"function"==typeof a.settings.fail&&a.settings.fail(h,e,c)}},l=function(e){for(var c=e.data,d=0;d<a.settings.height;d++)for(var f=0;f<a.settings.width;f++){var b=4*(a.settings.width*d+f),g=a.settings.filter({offset:b,x:f,y:d,red:c[b],green:c[b+1],blue:c[b+2],alpha:c[b+3]});c[b]=g[0];c[b+1]=g[1];c[b+2]=g[2];c[b+3]=g[3]}return e};a.snap=function(e,d,f,g){if("undefined"==typeof e||"undefined"==typeof d||"undefined"==typeof f||"undefined"==typeof g)d=e=0,f=a.settings.width,g=a.settings.height;return c.getContext("2d").getImageData(e,d,f,g)};a.save=function(a,d){"undefined"==typeof a&&(a="png");"undefined"==typeof d&&(d=1);return c.toDataURL("image/"+a,d)};(function(){a.settings=f.extend({},d,g);navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;if(navigator.getUserMedia&&window.requestAnimationFrame){c.width=a.settings.width;c.height=a.settings.height;var e=document.createElement("video");e.style.display="none";e.autoplay=!0;e.width=a.settings.width;e.height=a.settings.height;c.parentNode.insertBefore(e,c.nextSibling);m(e)}else"function"==typeof a.settings.unsupported&&a.settings.unsupported()})()};f.fn.instacam=function(c){var g=f(this).data("instacam");if(void 0===g)return this.each(function(){var a=new f.instacam(this,c);f(this).data("instacam",a)});if("object"==typeof c)f.each(c,function(a,c){g.settings[a]=c});else return g.settings[c]}})(jQuery);