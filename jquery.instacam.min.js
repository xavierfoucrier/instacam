!function(t){"use strict";t.instacam=function(e,i){var s=this,n={width:400,height:300,mirror:!1,camera:!0,framerate:30,ratio:4/3,sound:!1,volume:100,opacity:1,brightness:1,contrast:1,saturation:0,hue:0,invert:0,grayscale:0,sepia:0,blur:0,url:"",filter:null,done:null,fail:null,unsupported:null},a=function(i){try{navigator.getUserMedia({video:!1!==s.settings.camera&&{mandatory:{minFrameRate:"number"==typeof s.settings.framerate&&s.settings.framerate>0?s.settings.framerate:n.framerate,maxFrameRate:"number"==typeof s.settings.framerate&&s.settings.framerate>0?s.settings.framerate:n.framerate,minAspectRatio:"number"==typeof s.settings.ratio&&s.settings.ratio>0?s.settings.ratio:n.ratio,maxAspectRatio:"number"==typeof s.settings.ratio&&s.settings.ratio>0?s.settings.ratio:n.ratio}},audio:s.settings.sound},function(a){"srcObject"in i?i.srcObject=a:i.src=window.URL.createObjectURL(a),i.addEventListener("play",function(){i.volume=("number"==typeof s.settings.volume&&s.settings.volume>=0&&s.settings.volume<=100?s.settings.volume:n.volume)/100});var o=function(){requestAnimationFrame(o),"function"!=typeof s.settings.filter?e.getContext("2d").drawImage(i,0,0,s.settings.width,s.settings.height):(void 0===s.buffer&&(s.buffer=document.createElement("canvas"),s.buffer.style.display="none",s.buffer.width=s.settings.width,s.buffer.height=s.settings.height,e.parentNode.insertBefore(s.buffer,e.nextSibling)),s.buffer.getContext("2d").drawImage(i,0,0,s.settings.width,s.settings.height),e.getContext("2d").putImageData(r(s.buffer.getContext("2d").getImageData(0,0,s.settings.width,s.settings.height)),0,0));var a=s.settings.opacity!=n.opacity?"opacity("+s.settings.opacity+") ":"";a+=s.settings.brightness!=n.brightness?"brightness("+s.settings.brightness+") ":"",a+=s.settings.contrast!=n.contrast?"contrast("+s.settings.contrast+") ":"",a+=s.settings.saturation!=n.saturation?"saturate("+s.settings.saturation+") ":"",a+=s.settings.hue!=n.hue?"hue-rotate("+s.settings.hue+"deg) ":"",a+=s.settings.invert!=n.invert?"invert("+s.settings.invert+") ":"",a+=s.settings.grayscale!=n.grayscale?"grayscale("+s.settings.grayscale+") ":"",a+=s.settings.sepia!=n.sepia?"sepia("+s.settings.sepia+") ":"",a+=s.settings.blur!=n.blur?"blur("+s.settings.blur+"px) ":"",""!==(a+=s.settings.url!=n.url?"url("+s.settings.url+") ":"")&&s.css!=a?(t(e).css({filter:a,"-webkit-filter":a}),s.css=a):""===a&&(t(e).css({filter:"","-webkit-filter":""}),s.css=""),!0===s.settings.mirror?t(e).css({transform:"scale(-1, 1)","-webkit-transform":"scale(-1, 1)"}):t(e).css({transform:"","-webkit-transform":""})};requestAnimationFrame(o),"function"==typeof s.settings.done&&s.settings.done(i,e)},function(t){"function"==typeof s.settings.fail&&s.settings.fail(t,i,e)})}catch(t){"function"==typeof s.settings.fail&&s.settings.fail(t,i,e)}},r=function(t){for(var e=t.data,i=0;i<s.settings.height;i++)for(var n=0;n<s.settings.width;n++){var a=4*(s.settings.width*i+n),r=s.settings.filter({offset:a,x:n,y:i,red:e[a],green:e[a+1],blue:e[a+2],alpha:e[a+3]});e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2],e[a+3]=r[3]}return t};s.snap=function(t,i,n,a){return void 0!==t&&void 0!==i&&void 0!==n&&void 0!==a||(t=0,i=0,n=s.settings.width,a=s.settings.height),e.getContext("2d").getImageData(t,i,n,a)},s.save=function(t,i){return void 0===t&&(t="png"),void 0===i&&(i=1),e.toDataURL("image/"+t,i)},function(){if(s.settings=t.extend({},n,i),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,navigator.getUserMedia&&window.requestAnimationFrame){e.width=s.settings.width,e.height=s.settings.height;var r=document.createElement("video");r.style.display="none",r.autoplay=!0,r.width=s.settings.width,r.height=s.settings.height,e.parentNode.insertBefore(r,e.nextSibling),a(r)}else"function"==typeof s.settings.unsupported&&s.settings.unsupported()}()},t.fn.instacam=function(e){var i=t(this).data("instacam");return void 0===i?this.each(function(){var i=new t.instacam(this,e);t(this).data("instacam",i)}):"object"!=typeof e?i.settings[e]:void t.each(e,function(t,e){i.settings[t]=e})}}(jQuery);