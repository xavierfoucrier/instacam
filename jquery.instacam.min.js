(function(d){d.instacam=function(c,g){var a=this,e={width:400,height:300,mirror:!1,camera:!0,sound:!1,opacity:1,brightness:1,contrast:1,saturation:0,hue:0,invert:0,grayscale:0,sepia:0,blur:0,url:"",filter:null,done:null,fail:null,unsupported:null},m=function(f){try{navigator.getUserMedia({video:a.settings.camera,audio:a.settings.sound},function(k){f.src=window.URL.createObjectURL(k);var h=function(){requestAnimationFrame(h);"function"!=typeof a.settings.filter?c.getContext("2d").drawImage(f,0,0,a.settings.width,a.settings.height):("undefined"==typeof a.buffer&&(a.buffer=document.createElement("canvas"),a.buffer.setAttribute("width",a.settings.width),a.buffer.setAttribute("height",a.settings.height),c.parentNode.insertBefore(a.buffer,c.nextSibling),d(a.buffer).hide()),a.buffer.getContext("2d").drawImage(f,0,0,a.settings.width,a.settings.height),c.getContext("2d").putImageData(l(a.buffer.getContext("2d").getImageData(0,0,a.settings.width,a.settings.height)),0,0));var b=a.settings.opacity!=e.opacity?"opacity("+a.settings.opacity+") ":"",b=b+(a.settings.brightness!=e.brightness?"brightness("+a.settings.brightness+") ":""),b=b+(a.settings.contrast!=e.contrast?"contrast("+a.settings.contrast+") ":""),b=b+(a.settings.saturation!=e.saturation?"saturate("+a.settings.saturation+") ":""),b=b+(a.settings.hue!=e.hue?"hue-rotate("+a.settings.hue+"deg) ":""),b=b+(a.settings.invert!=e.invert?"invert("+a.settings.invert+") ":""),b=b+(a.settings.grayscale!=e.grayscale?"grayscale("+a.settings.grayscale+") ":""),b=b+(a.settings.sepia!=e.sepia?"sepia("+a.settings.sepia+") ":""),b=b+(a.settings.blur!=e.blur?"blur("+a.settings.blur+"px) ":""),b=b+(a.settings.url!=e.url?"url("+a.settings.url+") ":"");""!==b&&a.css!=b?(d(c).css({filter:b,"-webkit-filter":b}),a.css=b):""===b&&(d(c).css({filter:"","-webkit-filter":""}),a.css="");!0===a.settings.mirror?d(c).css({transform:"scale(-1, 1)","-webkit-transform":"scale(-1, 1)"}):d(c).css({transform:"","-webkit-transform":""})};requestAnimationFrame(h);"function"==typeof a.settings.done&&a.settings.done(f,c)},function(){"function"==typeof a.settings.fail&&a.settings.fail(f,c)})}catch(k){"function"==typeof a.settings.fail&&a.settings.fail(f,c)}},l=function(f){for(var c=f.data,d=0;d<a.settings.height;d++)for(var e=0;e<a.settings.width;e++){var b=4*(a.settings.width*d+e),g=a.settings.filter({offset:b,x:e,y:d,red:c[b],green:c[b+1],blue:c[b+2],alpha:c[b+3]});c[b]=g[0];c[b+1]=g[1];c[b+2]=g[2];c[b+3]=g[3]}return f};a.snap=function(f,d,e,g){if("undefined"==typeof f||"undefined"==typeof d||"undefined"==typeof e||"undefined"==typeof g)d=f=0,e=a.settings.width,g=a.settings.height;return c.getContext("2d").getImageData(f,d,e,g)};a.save=function(a,d){"undefined"==typeof a&&(a="png");"undefined"==typeof d&&(d=1);return c.toDataURL("image/"+a,d)};(function(){a.settings=d.extend({},e,g);navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;if(navigator.getUserMedia&&window.requestAnimationFrame){c.setAttribute("width",a.settings.width);c.setAttribute("height",a.settings.height);var f=document.createElement("video");f.setAttribute("autoplay","1");f.setAttribute("width",a.settings.width);f.setAttribute("height",a.settings.height);d(f).hide();c.parentNode.insertBefore(f,c.nextSibling);m(f)}else"function"==typeof a.settings.unsupported&&a.settings.unsupported()})()};d.fn.instacam=function(c){var g=d(this).data("instacam");if(void 0===g)return this.each(function(){var a=new d.instacam(this,c);d(this).data("instacam",a)});if("object"==typeof c)d.each(c,function(a,c){g.settings[a]=c});else return g.settings[c]}})(jQuery);